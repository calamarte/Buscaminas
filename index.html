<!DOCTYPE html>
<html manifest="cache.appcache" lang="es">
  <head>
    <meta  charset="utf-8">
    <meta name="description" content="Informacion personal">
    <meta name="keyswords" content="juego,videojuego,buscaminas">
    <meta name="author" content="Jose Navarro">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots">
    <link rel="stylesheet" type="text/css" href="css/nav.css">
    <title>Buscaminas</title>
  </head>
  <body>
    <header class="col-12">
      <h1>Buscaminas</h1>
    <nav>
      <ul>
        <li><a href="index.html">Indice</a></li>
        <li><a href="contacto.html">Contacto</a></li>
        <li><a href="quien_soy.html">¿Quien soy?</a></li>
        <li><a href="ayuda.html">Ayuda</a></li>
        <li><a href="configuracion_juego.html">Configuración del juego</a></li>
      </ul>
    </nav>
  </header>
    <main>
      <div>
        <canvas id="minas" width="500" height="500">
        </canvas>
      </div>
      <!--<div class="animacion col-12">-->
      	<!--<img src="mina.png" alt="una mina">-->
      <!--</div>-->
    </main>
    <script type="text/javascript">
      var canvas = document.getElementById("minas");
      var canvasTa = canvas.width;
      var p = canvas.getBoundingClientRect();
      var ctx = canvas.getContext("2d");
      var a = [];
      var y = 0;
      var x = 0;
      var cont = 0;
      var tam = 25;
      var bombas = 50;

      for(var i = 0; i < 20;i++){
          for(var j = 0; j < 20;j++){
              var aux = new celda(tam,x,y);
              a[cont] = (new celda(tam,x,y));
             // ctx.fillStyle = "red";
              //ctx.fillRe
              aux.pintarIn();
              aux.pintarBo();
              x += tam;
              cont++
          }
          x = 0;
          y +=tam;
      }
      bombasPos();

      function bombasPos() {
          for(var i = 0; i < bombas ; i++){
              var r = Math.round(Math.random() * 400);
              if(a[r].mina){
                  i--;
                  continue;
              }

              a[r].mina = true;

              //fallan limites
              if (r - 1 >= 0 && !a[r-1].mina)a[r-1].minacerca++;
              if (r + 1 < 400 && !a[r+1].mina)a[r+1].minacerca++;
              if (r - 21 >= 0 && !a[r-21].mina)a[r-21].minacerca++;
              if (r - 20 >= 0 && !a[r-20].mina)a[r-20].minacerca++;
              if (r - 19 >= 0 && !a[r-19].mina)a[r-19].minacerca++;
              if (r + 19 < 400 && !a[r+19].mina)a[r+19].minacerca++;
              if (r + 20 < 400 && !a[r+20].mina)a[r+20].minacerca++;
              if (r + 21 < 400 && !a[r+21].mina)a[r+21].minacerca++;

          }
      }

      function celda(tamano,x,y,minacerca) {
          this.x = x;
          this.y = y;
          this.mina = false;
          this.minacerca = 0;
          this.t = tamano;

          this.pintarBo = function () {
            ctx.strokeRect(x,y,this.t,this.t);
          };

          this.pintarIn =function () {
              ctx.fillStyle = "white";
                ctx.fillRect(x,y,this.t,this.t);
          };

          this.explotar = function () {
            if (this.mina){
                ctx.fillStyle = "red";
                ctx.fillRect(x,y,this.t,this.t);
            }
            else {
                ctx.fillStyle = "blue";
                ctx.fillRect(x,y,this.t,this.t);
                ctx.fillStyle = "white";
                ctx.font = "20px Arial";
                ctx.fillText(JSON.stringify(this.minacerca),x+5,y+20);
            }
          };
      }

      canvas.addEventListener("click",function (e) {
          var x = e.clientX - p.left;
          var y = e.clientY - p.top;
          jugar(x,y);
      });

        function jugar(x,y) {
            for(var i = 0; i < a.length;i++){
                if (x < (a[i].x +tam) && x > a[i].x && y < (a[i].y + tam) && y > a[i].y){
                    a[i].explotar();
                }
            }
        }

    </script>
  </body>
</html>
